{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Hello Word","text":"<p>\u6ca1\u4e8b\u5199\u5199\u6587\u7ae0, \u8bb0\u5f55\u65e5\u5e38\u4e2d\u7684\u70b9\u70b9\u6ef4\u6ef4</p>"},{"location":"about/","title":"\u4f5c\u8005\u4e0e\u7ad9\u70b9","text":"<p>\u804a\u4e00\u804a\u5173\u4e8e\u4f5c\u8005\u548c\u8fd9\u4e2a\u7ad9\u70b9\u7684\u4e00\u4e9b\u4e8b\u60c5\u3002</p>"},{"location":"about/#_1","title":"\u5173\u4e8e\u672c\u7ad9","text":"<p>\u4e3b\u8981\u662f\u4e3a\u4e86\u8bb0\u5f55\u65e5\u5e38\u7684\u70b9\u70b9\u6ef4\u6ef4</p>"},{"location":"about/#_2","title":"\u5173\u4e8e\u4f5c\u8005","text":"<p>\u4f5c\u8005\u5f53\u524d\u4e3b\u8425\u4e1a\u52a1\u662f\u4e00\u540d SA, \u4e5f\u5c31\u662f SB \u597d\u4e00\u4e22\u4e22\u3002</p> <p>\u4e13\u6ce8\u4e8e<code>\u5b89\u5168</code>\u3001<code>Linux</code>\u3001<code>Coding</code>\u3001<code>\u5e26\u5a03</code>\u3002</p>"},{"location":"tags/","title":"\u6807\u7b7e tags","text":"","tags":[]},{"location":"tags/#tag:shadowvpn","title":"ShadowVPN","text":"<ul> <li>            openwrt \u4e0a\u642d\u5efa ShadowVPN Server          </li> </ul>","tags":[]},{"location":"tags/#tag:vpn","title":"VPN","text":"<ul> <li>            openwrt \u4e0a\u642d\u5efa ShadowVPN Server          </li> </ul>","tags":[]},{"location":"tags/#tag:archlinux","title":"archlinux","text":"<ul> <li>            \u5728\u4e91\u4e3b\u673a\u4e0a\u52a0\u5bc6\u78c1\u76d8\u6765\u5b89\u88c5archlinux          </li> </ul>","tags":[]},{"location":"tags/#tag:birthday","title":"birthday","text":"<ul> <li>            2015 birthday          </li> </ul>","tags":[]},{"location":"tags/#tag:cloud","title":"cloud","text":"<ul> <li>            \u5728\u4e91\u4e3b\u673a\u4e0a\u52a0\u5bc6\u78c1\u76d8\u6765\u5b89\u88c5archlinux          </li> </ul>","tags":[]},{"location":"tags/#tag:date","title":"date","text":"<ul> <li>            \u770b\u65e5\u5b50          </li> </ul>","tags":[]},{"location":"tags/#tag:disk","title":"disk","text":"<ul> <li>            \u5728\u4e91\u4e3b\u673a\u4e0a\u52a0\u5bc6\u78c1\u76d8\u6765\u5b89\u88c5archlinux          </li> </ul>","tags":[]},{"location":"tags/#tag:dropbear","title":"dropbear","text":"<ul> <li>            \u5728\u4e91\u4e3b\u673a\u4e0a\u52a0\u5bc6\u78c1\u76d8\u6765\u5b89\u88c5archlinux          </li> </ul>","tags":[]},{"location":"tags/#tag:encrypt","title":"encrypt","text":"<ul> <li>            \u5728\u4e91\u4e3b\u673a\u4e0a\u52a0\u5bc6\u78c1\u76d8\u6765\u5b89\u88c5archlinux          </li> </ul>","tags":[]},{"location":"tags/#tag:family","title":"family","text":"<ul> <li>            2015 birthday          </li> </ul>","tags":[]},{"location":"tags/#tag:grub","title":"grub","text":"<ul> <li>            \u5728\u4e91\u4e3b\u673a\u4e0a\u52a0\u5bc6\u78c1\u76d8\u6765\u5b89\u88c5archlinux          </li> </ul>","tags":[]},{"location":"tags/#tag:https","title":"https","text":"<ul> <li>            \u7b80\u5355\u7406\u89e3 https          </li> </ul>","tags":[]},{"location":"tags/#tag:initrd","title":"initrd","text":"<ul> <li>            \u5728\u4e91\u4e3b\u673a\u4e0a\u52a0\u5bc6\u78c1\u76d8\u6765\u5b89\u88c5archlinux          </li> </ul>","tags":[]},{"location":"tags/#tag:key","title":"key","text":"<ul> <li>            \u7b80\u5355\u7406\u89e3 https          </li> </ul>","tags":[]},{"location":"tags/#tag:lock","title":"lock","text":"<ul> <li>            TimedRotatingFileHandler \u7684\u4e24\u4e2a\u95ee\u9898          </li> </ul>","tags":[]},{"location":"tags/#tag:logging","title":"logging","text":"<ul> <li>            TimedRotatingFileHandler \u7684\u4e24\u4e2a\u95ee\u9898          </li> </ul>","tags":[]},{"location":"tags/#tag:luks","title":"luks","text":"<ul> <li>            \u5728\u4e91\u4e3b\u673a\u4e0a\u52a0\u5bc6\u78c1\u76d8\u6765\u5b89\u88c5archlinux          </li> </ul>","tags":[]},{"location":"tags/#tag:marcau","title":"marcau","text":"<ul> <li>            2015\u6fb3\u95e8\u884c          </li> </ul>","tags":[]},{"location":"tags/#tag:mkinitcpio","title":"mkinitcpio","text":"<ul> <li>            \u5728\u4e91\u4e3b\u673a\u4e0a\u52a0\u5bc6\u78c1\u76d8\u6765\u5b89\u88c5archlinux          </li> </ul>","tags":[]},{"location":"tags/#tag:openwrt","title":"openwrt","text":"<ul> <li>            openwrt \u4e0a\u642d\u5efa ShadowVPN Server          </li> </ul>","tags":[]},{"location":"tags/#tag:photography","title":"photography","text":"<ul> <li>            2015\u6fb3\u95e8\u884c          </li> <li>            \u5a5a\u7eb1\u71671          </li> </ul>","tags":[]},{"location":"tags/#tag:problem","title":"problem","text":"<ul> <li>            TimedRotatingFileHandler \u7684\u4e24\u4e2a\u95ee\u9898          </li> </ul>","tags":[]},{"location":"tags/#tag:python","title":"python","text":"<ul> <li>            TimedRotatingFileHandler \u7684\u4e24\u4e2a\u95ee\u9898          </li> </ul>","tags":[]},{"location":"tags/#tag:screenshot","title":"screenshot","text":"<ul> <li>            2015 birthday          </li> </ul>","tags":[]},{"location":"tags/#tag:security","title":"security","text":"<ul> <li>            \u5728\u4e91\u4e3b\u673a\u4e0a\u52a0\u5bc6\u78c1\u76d8\u6765\u5b89\u88c5archlinux          </li> <li>            \u7b80\u5355\u7406\u89e3 https          </li> </ul>","tags":[]},{"location":"tags/#tag:shadowsock","title":"shadowsock","text":"<ul> <li>            openwrt \u4e0a\u642d\u5efa ShadowVPN Server          </li> </ul>","tags":[]},{"location":"tags/#tag:ssh","title":"ssh","text":"<ul> <li>            \u5728\u4e91\u4e3b\u673a\u4e0a\u52a0\u5bc6\u78c1\u76d8\u6765\u5b89\u88c5archlinux          </li> </ul>","tags":[]},{"location":"tags/#tag:ssl","title":"ssl","text":"<ul> <li>            \u7b80\u5355\u7406\u89e3 https          </li> </ul>","tags":[]},{"location":"tags/#tag:taobao","title":"taobao","text":"<ul> <li>            \u5a5a\u7eb1\u71671          </li> </ul>","tags":[]},{"location":"tags/#tag:tourism","title":"tourism","text":"<ul> <li>            2015\u6fb3\u95e8\u884c          </li> </ul>","tags":[]},{"location":"tags/#tag:upset","title":"upset","text":"<ul> <li>            \u770b\u65e5\u5b50          </li> </ul>","tags":[]},{"location":"tags/#tag:vm","title":"vm","text":"<ul> <li>            \u5728\u4e91\u4e3b\u673a\u4e0a\u52a0\u5bc6\u78c1\u76d8\u6765\u5b89\u88c5archlinux          </li> </ul>","tags":[]},{"location":"tags/#tag:wedding","title":"wedding","text":"<ul> <li>            \u5a5a\u7eb1\u71671          </li> <li>            \u770b\u65e5\u5b50          </li> </ul>","tags":[]},{"location":"blog/","title":"\u535a\u5ba2\u6587\u7ae0","text":""},{"location":"blog/2012/12/01/simple-understand-https/","title":"\u7b80\u5355\u7406\u89e3 https","text":"<p>\u4e2a\u4eba\u7b80\u5355\u7684\u7406\u89e3\uff0c\u5f53\u4f5c\u8bb0\u5f55\u4e00\u4e0b.</p> <ol> <li>client connet \u5230 server.</li> <li>server \u53d1 pubkey \u7ed9 client </li> <li>client \u7528 \u751f\u6210\u4e00\u4e2a\u5bf9\u79f0\u5bc6\u94a5 pass\uff0c\u5e76\u7528<code>2</code>\u6536\u5230\u7684 pubkey \u8fdb\u884c\u52a0\u5bc6, \u52a0\u5bc6\u540e\u4e3as_pass.</li> <li>client \u5c06http\u5185\u5bb9 \u7ecf\u8fc7SSL\u5c42\u52a0\u5bc6\u540e\u548cs_pass\u4e00\u8d77\u53d1\u9001\u7ed9server (\u8bf7\u6c42)</li> <li>server \u6536\u5230\u540e\u7528 private_key \u5bf9 s_pass \u8fdb\u884c\u89e3\u5bc6\uff0c\u5e76\u7528 pass \u5bf9http\u5185\u5bb9\u8fdb\u884c\u5bf9\u79f0\u52a0\u5bc6\uff0c\u53d1\u9001\u7ed9client.</li> <li> <p>client \u89e3\u5f00\uff0c\u5c55\u73b0\u51fa\u6765</p> </li> <li> <p>\u7531pubkey\u52a0\u5bc6\u8fc7\u7684\u5bc6\u94a5\uff0c\u53ef\u4ee5\u4f7f\u7528\u79c1\u94a5(private_key) \u8fdb\u884c\u89e3\u5bc6.</p> </li> </ol>","tags":["https","ssl","key","security"]},{"location":"blog/2015/08/16/Wedding-photo-0/","title":"\u5a5a\u7eb1\u71671","text":"<p>\u5927\u6982\u662f\u5e74\u7eaa\u5927\u4e86\uff0c\u8fd8\u662f\u56e0\u4e3a\u6015\u82b1\u94b1\uff0c\u5bf9\u7ed3\u5a5a\u8fd9\u79cd\u5a5a\u7eb1\u6444\u5f71\u82b1\u94b1\u53d7\u7f6a\u7684\u4f3c\u4e4e\u4e0d\u600e\u4e48\u611f\u5174\u8da3\uff0c\u966a\u7740\u672a\u6765\u7684 LP \u5728\u67d0\u5de5\u4f5c\u5ba4\u54a8\u8be2\u4e86\u4e00\u4e2a\u4e0a\u5348\uff0c\u4e0d\u7ba1\u600e\u6837\u603b\u7b97\u5b8c\u6210\u4e86\u4e00\u4ef6\u4e8b\u60c5\u3002</p> <p></p>","tags":["photography","wedding","taobao"]},{"location":"blog/2015/08/17/Wedding-pick-date/","title":"\u770b\u65e5\u5b50","text":"<p>\u672c\u6765\u8bf4\u597d<code>10.1</code>\u7ed3\u5a5a\uff0c\u53ef\u662f\uff0c\u5bb6\u91cc\u627e\u4eba\u770b\u65e5\u5b50\uff0c\u8bf4\u6700\u5dee\u7684\u4e00\u5929\uff0c\u800c\u4e14\u6574\u4e2a\u56fd\u5e86\u4e43\u81f310\u6708\u4efd\u90fd\u6ca1\u597d\u65e5\u5b50\uff0c \u5f53\u65f6\u542c\u5230\u8001\u7238\u8ddf\u6211\u8bf4\u7684\uff0c\u5f88\u751f\u6c14\uff0c\u7b2c\u4e00\u6b21\u6302\u8001\u7238\u7684\u7535\u8bdd\u3002 \u540e\u6765\u6709\u8ddf\u8001\u5988\u4e89\u5435\uff0c\u8bf4\u4ed6\u4eec\u770b\u8fd9\u4e9b\u592a\u91cd\uff0c\u5f53\u521d\u5c31\u5e94\u8be5\u65e9\u70b9\u7ed9\u6211\u4eec\u770b\u65e5\u5b50\u3002\u3002\u3002</p> <p>\u4ed4\u7ec6\u60f3\u60f3\uff0c\u5176\u5b9e\u4ed6\u4eec\u4e5f\u662f\u4e3a\u4e86\u6211\u4eec\u597d\uff0c\u624d\u90a3\u4e48\u5728\u610f\u8fd9\u4e9b\u3002</p> <p>\u6700\u540e\uff0c\u5fcd\u7740\u75db\uff0c\u53ea\u597d\u8ddf\u672a\u6765\u8001\u5a46\u4ed6\u4eec\u4e00\u5bb6\u6c9f\u901a\uff0c\u8fd8\u597d\u4ed6\u4eec\u8fd8\u7406\u89e3\u3002</p> <p>\u53ea\u597d\uff0c\u63a8\u8fdf\u3002\u3002\u3002</p>","tags":["wedding","date","upset"]},{"location":"blog/2015/08/19/birthday-2015/","title":"2015 birthday","text":"<p>\u8fd8\u6709\u51e0\u5206\u949f\uff0c2015\u5e74\u7684\u751f\u65e5\u9a6c\u4e0a\u5c31\u8981\u8fc7\u53bb\u4e86\u3002 \u867d\u7136\u57fa\u672c\u4e0a\u6bcf\u5e74\u6211\u7684\u751f\u65e5\u90fd\u662f\u8ddf\u5e73\u65f6\u5dee\u4e0d\u591a\u7684\u8fc7\u53bb\uff0c \u4f46\u662f\u4eca\u5929\uff0c\u5374\u5f88\u7279\u522b\u3002</p> <p>\u96f6\u70b9\u7684\u65f6\u5019\u6536\u5230\u67d0\u4eba\u7684\u795d\u798f\uff0c\u5e76\u9644\u5e26\u4e86\u4e09\u4e2a\u5927\u7ea2\u5305\uff0c\u5fc3\u91cc\u6696\u6696\u7684\u3002 \u767d\u5929\u4f9d\u65e7\u4e0a\u73ed\uff0c \u665a\u4e0a\u8fc7\u53bb\u59d0\u59d0\u5bb6\uff0c\u5403\u8001\u5988\u505a\u7684\u5927\u9910\uff0c\u59d0\u59d0\u8fd8\u4e70\u4e86\u86cb\u7cd5\uff0c\u4e00\u5bb6\u4eba\u5531\u4e86\u751f\u65e5\u6b4c\uff0c \u5e78\u798f\u6ee1\u6ee1\u7684\uff01 \u53ea\u662f\u7531\u4e8e\u80fd\u529b\u95ee\u9898\uff0c\u672a\u80fd\u5168\u5bb6\u56e2\u805a\uff0c\u7565\u611f\u9057\u61be\uff0c\u52aa\u529b\u6323\u94b1\u5427\uff01</p> <p>\u518d\u8fc7\u51e0\u5206\u949f\u5c31\u662f\u4e03\u5915\u4e86\uff0c\u795d\u798f\u67d0\u4eba\u4e03\u5915\u5feb\u4e50\uff0c\u5929\u5929\u5f00\u5fc3\uff01</p> <p></p>","tags":["screenshot","birthday","family"]},{"location":"blog/2015/08/26/two-problems-of-TimedRotatingFileHandler/","title":"TimedRotatingFileHandler \u7684\u4e24\u4e2a\u95ee\u9898","text":"","tags":["logging","python","lock","problem"]},{"location":"blog/2015/08/26/two-problems-of-TimedRotatingFileHandler/#timedrotatingfilehandler","title":"TimedRotatingFileHandler","text":"<p>\u4e4b\u524d\u9047\u5230\u591a\u8fdb\u7a0b\u4e0b\u9762\u65e5\u5fd7\u8f6e\u8f6c\u7684\u95ee\u9898\uff0c\u627e\u4e86\u597d\u4e45\u90fd\u6ca1\u6709\u627e\u5230\u73b0\u6709\u7684\u6309\u65f6\u95f4\u8f6e\u8f6c\u7684\u89e3\u51b3\u65b9\u6848\u3002 \u51b3\u5b9a\u81ea\u5df1\u53bb\u5b9e\u73b0\u4e00\u4e2a\uff0c\u6240\u4ee5\u7ffb\u7ffb<code>logging</code>\u7684<code>TimedRotatingFileHandler</code>\u53d1\u73b0\u5176\u4e2d\u6bd4\u8f83\u4e0d\u5408\u7406\u7684\u95ee\u9898</p>","tags":["logging","python","lock","problem"]},{"location":"blog/2015/08/26/two-problems-of-TimedRotatingFileHandler/#_1","title":"\u8f6e\u8f6c\u65f6\u95f4\u95ee\u9898","text":"<p><pre><code>        def __init__(self, filename, when='h', interval=1, backupCount=0, encoding=None, delay=False, utc=False):\n            ...\n            if os.path.exists(filename):\n                t = os.stat(filename)[ST_MTIME]\n            else:\n                t = int(time.time())\n            self.rolloverAt = self.computeRollover(t)\n\n        def computeRollover(self, currentTime):\n            \"\"\" ... \"\"\"\n            result = currentTime + self.interval\n            ...\n</code></pre> \u4ece\u4e0a\u9762\u7684\u4ee3\u7801\u53ef\u4ee5\u770b\u51fa\uff0c\u5b83\u7684\u8f6e\u8f6c\u65f6\u95f4\u662f\u6839\u636e\u542f\u52a8\u65f6\u95f4(\u65e5\u5fd7\u6587\u4ef6\u5b58\u5728mtime)\u4e3a\u8d77\u70b9\uff0c\u5230\u8fbe <code>self.interval</code> \uff08\u5355\u4f4d\u662fs)\u5c31\u4f1a\u8fdb\u884c\u8f6e\u8f6c\uff0c \u6240\u4ee5\u8f6e\u8f6c\u65e5\u5fd7\u7684\u65f6\u5019\u5c31\u6709\u5f88\u5927\u53ef\u80fd\u4e0d\u662f\u5728\u6574\u70b9/\u6574\u5206/\uff0c\u5373 \u5982\u679c\u4f60\u8bbe\u7f6e\u4e86\u6bcf\u4e2a\u5c0f\u65f6\u8f6e\u8f6c\uff0c\u542f\u52a8\u662f\u5728<code>09:31:01</code>\uff0c\u90a3\u4e48\u4e0b\u4e00\u4e2a\u8f6e\u8f6c\u70b9\u5c31\u4f1a\u662f<code>10:31:01</code>\uff0c \u8fd9\u6837\u5bfc\u81f4\u7684\u95ee\u9898\u662f\uff0c\u627e<code>10:30</code>\u7684\u65e5\u5fd7\uff0c\u9700\u8981\u8dd1\u6587\u4ef6\u540d\u4e2d\u7684\u5c0f\u65f6\u4e3a 10 \u7684\u65e5\u5fd7\uff0c\u627e<code>10:32</code>\u7684\u9700\u8981\u4ece\u6587\u4ef6\u540d\u5c0f\u65f6\u4e3a11\u7684\u65e5\u5fd7\u91cc\u9762\u627e\u3002 \u5e76\u4e0d\u662f\u6211\u4eec\u5e73\u65f6\u9700\u8981\u7684\u6bcf\u5230\u6574\u70b9\u5c31\u8f6e\u8f6c\u3002</p>","tags":["logging","python","lock","problem"]},{"location":"blog/2015/08/26/two-problems-of-TimedRotatingFileHandler/#_2","title":"\u591a\u8fdb\u7a0b\u5199\u95ee\u9898","text":"<p><pre><code>    class TimedRotatingFileHandler(BaseRotatingHandler):\n</code></pre> \u8fd9\u4e2a\u7c7b\u7ee7\u627f\u4e86<code>BaseRotatingHandler</code> \u6211\u4eec\u518d\u770b\u770b<code>BaseRotatingHandler</code></p> <p><pre><code>    class BaseRotatingHandler(logging.FileHandler):\n</code></pre> \u53d1\u73b0<code>BaseRotatingHandler</code>\u91cc\u9762\u5e76\u6ca1\u6709\u4ec0\u4e48\u52a0\u9501\u7684\u903b\u8f91\uff0c\u6211\u4eec\u518d\u8fc7\u53bb\u770b\u770b<code>logging.FileHandler</code></p> <p><pre><code>    class FileHandler(StreamHandler):\n</code></pre> \u53d1\u73b0<code>FileHandler</code>\u91cc\u9762\u5bf9\u53ea\u662f\u5bf9<code>close</code>\u5173\u95ed\u65e5\u5fd7\u6587\u4ef6\u53e5\u67c4\u7684\u65f6\u5019\u505a\u4e86\u7ebf\u7a0b\u9501\uff0c\u5e76\u6ca1\u6709\u9488\u5bf9\u5199\u65e5\u5fd7\u7684\u9501\u3002\u4f9d\u7136\u8fc7\u53bb\u770b\u770b<code>StreamHandler</code>:</p> <p><pre><code>        def flush(self):\n            \"\"\"\n            Flushes the stream.\n            \"\"\"\n            self.acquire()\n            try:\n                if self.stream and hasattr(self.stream, \"flush\"):\n                    self.stream.flush()\n            finally:\n                self.release()\n        def emit(self, record):\n            ...\n            stream.write(fs % msg)\n            ...\n            self.flush()\n            ...\n</code></pre> \u4ece\u4e0a\u9762\u4ee3\u7801\u53ef\u4ee5\u770b\u5230\uff0c<code>StreamHandler</code>\u91cc\u9762\u662f\u628a\u65e5\u5fd7\u5148<code>write</code>\u5230\u7cfb\u7edf\u7684<code>cache</code>\u91cc\u9762\uff0c\u7136\u540e\u518d\u8c03\u7528<code>flush</code>\u5230\u78c1\u76d8\uff0c \u5f53<code>flush</code>\u7684\u65f6\u5019\u662f\u505a\u4e86\u7ebf\u7a0b\u9501\u7684\uff0c\u6240\u4ee5\u5199\u65e5\u5fd7\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002 \u4f46\u662f\u6211\u4eec\u5e76\u6ca1\u6709\u627e\u5230\u76f8\u5173\u7684\u6587\u4ef6\u9501\u6216\u8005\u5171\u4eab\u5168\u5c40\u9501\uff0c\u5373\u4f7f\u5b83\u5199\u65e5\u5fd7\u662f\u7ebf\u7a0b\u5b89\u5168\uff0c\u5982\u679c\u51fa\u73b0\u591a\u4e2a\u540c\u6837\u7684\u8fdb\u7a0b\uff0c \u540c\u65f6\u5199\u540c\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\uff0c\u4f1a\u51fa\u73b0\u600e\u6837\u5462\uff1f \u8fd9\u4e2a\u65f6\u5019\u5c31\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u540c\u7684\u8fdb\u7a0b\u4e89\u62a2\u6587\u4ef6IO\u7684\u95ee\u9898\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5199\u5931\u8d25\u800c\u4e22\u65e5\u5fd7\u7684\u60c5\u51b5\u3002</p>","tags":["logging","python","lock","problem"]},{"location":"blog/2015/10/05/marcau-tourism/","title":"2015\u6fb3\u95e8\u884c","text":"<p>\u4eca\u5e74\u56fd\u5e86\u5047\u671f\u5306\u5306\u5fd9\u5fd9\u8dd1\u4e00\u8d9f\u6fb3\u95e8\uff0c2014\u5e74\u81ea\u5df1\u4e5f\u53bb\u8fc7\u4e00\u6b21\uff0c\u4e0d\u540c\u7684\u662f\u8fd9\u6b21\u4e24\u4e2a\u4eba\uff0c\u6240\u4ee5\u8fd9\u6b21\u7684\u6fb3\u95e8\u884c\u4e3b\u8981\u662f<code>\u966a\u901b</code>\uff0c<code>Shopping</code>\u3002</p>","tags":["photography","tourism","marcau"]},{"location":"blog/2015/10/05/marcau-tourism/#_1","title":"\u51fa\u53d1\u524d","text":"<p>\u7531\u4e8e\u4e4b\u524d\u5de5\u4f5c\u8d76\u9879\u76ee\uff0c\u6765\u4e0d\u53ca\u8ba1\u5212\u8fd9\u6b21\u7684\u65c5\u884c\uff0c\u5230\u4e86\u56fd\u5e86\u5047\u671f\u624d\u6765\u505a\u8fd9\u4e2a\u51c6\u5907\uff0c\u663e\u7136\u6709\u70b9\u8fdf\u4e86\u3002</p> <p>\u4e3b\u8981\u8003\u8651\u5230\u8fc7\u5173\u7684\u4eba\u5f88\u591a\uff0c\u9700\u8981\u6392\u5f88\u4e45\u961f\uff0c\u6240\u4ee5\u4e00\u5b9a\u8981\u5c3d\u91cf\u65e9\u70b9\u8fc7\u53bb\u8fc7\u5173\uff0c\u4e8e\u662f\u60f3\u5728\u73e0\u6d77\u5148\u4f4f\u4e00\u665a\uff0c\u7b2c\u4e8c\u5929\u65e9\u4e0a\u65e9\u70b9\u8fc7\u53bb\u3002\u8054\u7cfb\u4e86\u5f88\u591a\u9152\u5e97\uff0c\u4ef7\u94b1\u90fd\u6bd4\u5e73\u65f6\u5347\u4e86\u4e00\u500d\uff0c\u751a\u81f3\u8fd8\u623f\u6ee1\u7684\u72b6\u6001\uff0c\u540e\u6765\u60f3\u8d77\u53ea\u597d\u8d76\u6700\u65e9\u7684\u4e00\u73ed\u57ce\u8f68\u8fc7\u53bb\uff0c\u6700\u65e9\u4e00\u73ed\u7684\u65f6\u95f4\u5927\u6982\u662f<code>6:30</code> \uff0c\u5728\u5929\u6cb3\u8fc7\u53bb\u5e7f\u5dde\u5357\u7ad9\u81f3\u5c11\u8981\u4e00\u4e2a\u591a\u5c0f\u65f6\u3002</p> <p>\u4ece\u65f6\u95f4\u8ddf\u91d1\u94b1\u4e0a\u9762\u5206\u6790\uff0c\u6700\u540e\uff0c\u6211\u4eec\u51b3\u5b9a\u5728\u5e7f\u5dde\u5357\u7ad9\u9644\u8fd1\u4f4f\u4e00\u665a\uff0c\u7b2c\u4e8c\u5929\u8d76\u6700\u65e9\u7684\u8f7b\u8f68\u5373\u53ef\u3002\u5b9e\u9645\u8868\u660e\u8fd9\u4e2a\u9009\u62e9\u662f\u6b63\u786e\u7684\uff0c\u8fd9\u4e2a\u65c5\u9986\u8fd8\u5305\u63a5\u9001\u3002\u8fd9\u662f\u7ecf\u9a8c0 ^_^</p>","tags":["photography","tourism","marcau"]},{"location":"blog/2015/10/05/marcau-tourism/#_2","title":"\u51fa\u53d1\u5566","text":"<p>\u8f7b\u8f68\u5f88\u51c6\u65f6\uff0c\u4e0d\u52308\u70b9\u5c31\u5230\u8fbe\u73e0\u6d77\u62f1\u5317\uff0c\u53ea\u662f\u89c9\u5f97\u80cc\u5305\u6709\u70b9\u91cd\uff0c\u4e8e\u662f\u53bb\u627e\u5bc4\u5b58\u7bb1\uff0c\u8c01\u77e5\u9053\u73e0\u6d77\u7ad9\u7684\u5bc4\u5b58\u670d\u52a1\u8fd8\u6ca1\u4e0a\u73ed\uff01\uff01\uff01\u53ea\u597d\u80cc\u7740\u8fc7\u53bb\u6fb3\u95e8\u4e86\u3002\u7ecf\u9a8c1\uff1a\u5e94\u8be5\u5728\u5e7f\u5dde\u5357\u7ad9\u7684\u65f6\u5019\u5bc4\u5b58\u3002</p> <p>\u8fc7\u5173\uff0c\u5979\u662f\u672c\u672c\u7684\uff0c\u6211\u662f\u7535\u5b50\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8dd1\u4e86\u4e24\u4e2a\u901a\u9053\uff0c\u8fd9\u4e2a\u65f6\u95f4\u8fc7\u5173\u7684\u57fa\u672c\u4e0a\u90fd\u662f\u7535\u5b50\u7684\uff0c\u4f30\u8ba1\u662f\u5f88\u591a\u4eba\u8fc7\u53bb\u6fb3\u95e8\u4e0a\u73ed\uff0c\u6240\u4ee5\u6211\u4eec\u7684\u8fc7\u5173\u65f6\u95f4\u90fd\u5dee\u4e0d\u591a\u3002\u7ecf\u9a8c2: \u5982\u679c\u65f6\u95f4\u65e9\uff0c\u901a\u884c\u8bc1\u672c\u672c\u8ddf\u7535\u5b50\u7684\u8fc7\u5173\u65f6\u95f4\u90fd\u5dee\u4e0d\u591a\uff0c\u5982\u679c\u518d\u8fdf\u70b9\uff0c\u53ef\u80fd\u672c\u672c\u7684\u6392\u961f\u4f1a\u5f88\u957f\uff0c\u6240\u4ee5\u80fd\u7535\u5b50\u7684\u5c3d\u91cf\u7528\u7535\u5b50\u7684\u3002</p>","tags":["photography","tourism","marcau"]},{"location":"blog/2015/10/05/marcau-tourism/#_3","title":"\u66b4\u8d70\u4e2d","text":"<p>\u8fc7\u5173\u540e\uff0c\u51fa\u6765\u5de6\u624b\u8fb9\u4fbf\u662f\u5a01\u5c3c\u65af\u4eba\u9152\u5e97\u7684\u514d\u8d39\u5df4\u58eb\uff0c\u5f88\u591a\u4eba\u6392\u961f\uff0c\u6240\u4ee5\u6211\u4eec\u7b2c\u4e00\u7ad9\u4fbf\u662f\u5a01\u5c3c\u65af\u4eba\u9152\u5e97\u3002</p> <p>\u5a01\u5c3c\u65af\u4eba\u9152\u5e97\u4e3b\u8981\u662f\u9152\u5e97\u4f4f\u5bbf\u3001\u8d2d\u7269\u3001\u8d4c\u573a\uff0c\u4ece\u7167\u7247\u8ddf\u6807\u4ef7\u4e0a\u770b\u90fd\u6bd4\u8f83\u9ad8\u7ea7\u5962\u534e\u3002\u6211\u4eec\u5c31\u56f4\u89c2\uff0c\u770b\u666f\u8272\uff0c\u770b\u522b\u4eba\u8c6a\u8d4c\u3002  </p> <p>\u4ece\u5a01\u5c3c\u65af\u4eba\u51fa\u6765\u540e\uff0c\u8fd8\u662f\u4ece\u4e0b\u8f66\u7684\u95e8\u51fa\u6765\uff0c\u53f3\u624b\u8fb9\u8d70\uff0c\u4e0a\u81ea\u52a8\u6276\u68af\uff0c\u4e00\u76f4\u8d70\u5230\u4e86\u9f99\u73af\u8461\u97f5\uff0c\u8fd9\u91cc\u4e3b\u8981\u662f\u8461\u8404\u7259\u4eba\u7684\u5c45\u4f4f\u73af\u5883\uff0c\u8461\u5f0f\u5efa\u7b51\uff0c\u4e2a\u4eba\u89c9\u5f97\u6ca1\u5565\u597d\u770b\u7684\u3002</p> <p>\u7136\u540e\u987a\u7740\u8def\u6807\u7ee7\u7eed\u8d70\u6ca1\u591a\u8fdc\u5c31\u5230\u4e86\u5b98\u4e5f\u8857\uff0c\u5f88\u5c0f\u7684\u5f88\u77ed\u7684\u7f8e\u98df\u8857\uff0c\u5403\u996d\u7684\uff0c\u7279\u4ea7\u7684\uff0c\u559d\u7684\u3002\u3002\u3002\u5f53\u7136\u5728\u8fd9\u91cc\u89e3\u51b3\u5348\u996d\u662f\u5f88\u660e\u667a\u7684\u9009\u62e9\uff0c\u7279\u522b\u63a8\u8350\u7684\u662f\u521a\u8fdb\u53bb\u8857\u53e3\u53f3\u624b\u8fb9\u6700\u540e\u4e00\u95f4\u5e97\uff0c\u597d\u50cf\u53eb<code>\u5174\u8bb0\u5496\u5561\u5ba4</code>,\u4e3a\u4ec0\u4e48\u63a8\u8350\u5462\uff0c\u4e3b\u8981\u662f\uff0c\u542c\u8ddf\u672c\u5730\u4eba\u804a\u5929\uff0c\u8bf4\u4e00\u76f4\u6ca1\u6da8\u4ef7\uff0c\u53e6\u5916\u4e00\u4e2a\u662f\u5473\u9053\u4e5f\u76f8\u5f53\u4e0d\u9519\u3002  </p> <p>\u89e3\u51b3\u5348\u996d\u540e\uff0c\u4fbf\u6b65\u884c\u56de\u53bb\u5a01\u5c3c\u65af\u4eba\u5750\u514d\u8d39\u5df4\u58eb\u5230\u91d1\u6c99\uff08\u6ce8\u610f\u4e0d\u662f\u91d1\u6c99\u57ce\uff09\uff0c\u6240\u4ee5\u4e0b\u4e00\u7ad9\u5c31\u662f\u6e14\u4eba\u7801\u5934\u4e86\u3002\u6e14\u4eba\u7801\u5934\u53ef\u4ee5\u770b\u5230\u6d77\u8fb9\uff0c\u770b\u5230\u5f88\u591a\u57ce\u5821\uff0c\u503c\u5f97\u8fc7\u53bb\u901b\u901b\u3002\u65e0\u5948\u90a3\u5929\u5929\u516c\u4e0d\u4f5c\u7f8e\uff0c\u6709\u70b9\u9635\u96e8\uff0c\u6ca1\u592a\u9633\uff0c\u6240\u4ee5\u62cd\u7167\u4e0d\u597d\u770b\u3002 </p> <p>\u5a01\u5c3c\u65af\u4eba\u8ddf\u91d1\u6c99\u4f30\u8ba1\u662f\u540c\u4e00\u4e2a\u8001\u677f\uff0c\u6240\u4ee5\u6709\u76f4\u63a5\u7684\u7a7f\u68ad\u5df4\u58eb\uff0c\u6211\u4eec\u4e0b\u4e00\u7ad9\u662f\u65b0\u9a6c\u8def\uff0c\u6240\u4ee5\u8981\u505a\u8f66\u5230\u8461\u4eac\uff0c\u4e3a\u4e86\u7701\u94b1\uff0c\u6211\u4eec\u505a\u4e86\u4e00\u4e2a\u9519\u8bef\u7684\u51b3\u5b9a\uff0c\u5148\u5728\u91d1\u6c99\u5750\u514d\u8d39\u5df4\u58eb\u5230\u6e2f\u6fb3\u7801\u5934\u7136\u540e\u518d\u8f6c\u5230\u65b0\u8461\u4eac\u7684\u8f66\u3002\u5230\u4e86\u6e2f\u6fb3\u7801\u5934\u53d1\u73b0\u5230\u8461\u4eac\u7684\u4eba\u4e0d\u662f\u4e00\u822c\u7684\u591a\uff0c\u6240\u4ee5\u7b49\u4e86\u597d\u4e45\u3002\u7ecf\u9a8c3:\u4e0b\u6b21\u5e94\u8be5\u76f4\u63a5\u5728\u91d1\u6c99\u6253\u7684\u58eb\u8fc7\u53bb\u3002</p> <p>\u5230\u4e86\u65b0\u8461\u4eac\uff0c\u8fd8\u662f\u8d4c\u573a\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u5ffd\u7565\uff0c\u8fc7\u53bb\u65b0\u9a6c\u8def\uff0cshopping\uff01\u65b0\u9a6c\u8def\u4eba\u5f88\u591a\uff0c\u53d8\u968f\u4fbf\u8fdb\u5165\u4e86\u4e00\u5bb6\u6fb3\u95e8\u672c\u571f\u7684\u91d1\u5e97<code>\u76db\u4e30</code>\u3002 \u5979\u6311\u4e86\u597d\u4e45\uff0c\u6700\u540e\u628a\u9700\u8981\u7684\u90fd\u5237\u5361\u4e70\u4e70\u4e70\u3002</p> <p>\u6212\u6307\u8981\u6539\u5927\u5c0f\uff0c\u6240\u4ee5\u6211\u4eec\u4e0b\u4e00\u7ad9\u5927\u4e09\u5df4\uff0c\u6fb3\u95e8\u6807\u5fd7\u6027\u666f\u70b9\uff0c\u62cd\u5f20\u7167\u7247\u8bc1\u660e\u5230\u8fc7\uff0c\u5373\u53ef\u3002\u7ee7\u7eed\u5f80\u4e0a\u8d70\u4fbf\u662f\u5927\u70ae\u53f0\u3002  </p>","tags":["photography","tourism","marcau"]},{"location":"blog/2015/10/05/marcau-tourism/#_4","title":"\u60b2\u50ac\u7684\u56de\u7a0b","text":"<p>\u770b\u65f6\u95f4\u5dee\u4e0d\u591a\u4e86\uff0c\u4fbf\u5f80\u56de\u8d76\uff0c\u62ff\u4e86\u6212\u6307\uff0c\u4fbf\u627e\u5730\u65b9\u5750\u8f66\u53bb\u5173\u53e3\uff0c\u672c\u6765\u60f3\u7b49\u516c\u4ea4\uff0c\u4f46\u662f\u7b49\u4e86\u597d\u4e45\u8fd8\u662f\u6ca1\u7b49\u5230\uff0c\u4fbf\u8fc7\u53bb\u65b0\u8461\u4eac\u770b\u770b\uff0c\u53d1\u73b0\u4eba\u66f4\u591a\uff0c\u6253\u7684\u90fd\u8981\u6392\u5f88\u957f\u5f88\u957f\u7684\u961f\u4f0d\uff0c\u6240\u4ee5\u8dd1\u5230\u5bf9\u9762\u7684\u516c\u4ea4\u7ad9\uff0c\u7ad9\u724c\u8ddf\u5b9e\u9645\u4e0a\u8f66\u7684\u5730\u70b9\u6709\u70b9\u4e0d\u7b26\uff0c\u7b49\u4e86\u597d\u4e45\u7ec8\u4e8e\u4e0a\u4e863x \u516c\u4ea4\uff0c\u65f6\u95f4\u5df2\u7ecf\u5f88\u665a\u4e86\uff0c<code>19:15</code>\u7684\u57ce\u8f68\u4f30\u8ba1\u662f\u6765\u4e0d\u53ca\u4e86\uff0c\u597d\u65e0\u5948\u3002</p> <p>\u6700\u540e\u5230\u5173\u53e3\u5df2\u7ecf<code>19:08</code>\u4e86\uff0c\u62ff\u7740\u8f66\u7968\u8ddf\u901a\u884c\u8bc1\u8d70\u4e86\u56fd\u9645\u5916\u4ea4\u53cb\u8c0a\u901a\u9053\uff0c\u95ea\u901f\u8fc7\u5173\uff0c\u4e00\u8def\u98de\u5954\u73e0\u6d77\u7ad9\uff0c\u8fd8\u662f\u6765\u4e0d\u53ca\uff0c\u770b\u5230\u5c4f\u5e55\u4e0a\u9762\u663e\u793a\u7684\u505c\u6b62\u68c0\u7968 \u5fc3\u90fd\u51c9\u4e86\uff0c\u53ea\u597d\u8fc7\u53bb\u4eba\u5de5\u7a97\u53e3\uff0c\u6392\u961f\uff0c\u6539\u7b7e\uff01\u6539\u7b7e\u8fd8\u662f\u6ca1\u6709\u5ea7\u4f4d\u7684\uff0c\u66f4\u7cdf\u7cd5\u7684\u662f\uff0c\u7adf\u7136\u665a\u70b9\u4e00\u4e2a\u591a\u5c0f\u65f6\uff0cWTF\uff01\u53ea\u597d\u5728\u5019\u8f66\u533a\u7b49\uff0c\u53cb\u5b9d\u4e0a\u9762\u4e70\u74f6\u6c34\u8fd8\u88ab\u541e5\u5757\u94b1\uff0c\u54ce\u2026\u2026 </p> <p>\u4e0a\u4e86\u57ce\u8f68\uff0c\u4e00\u8def\u4f1a\u5230\u5e7f\u5dde\u5357\uff0c\u7136\u540e\u5730\u94c1\uff0c\u5230\u4e86\u4e07\u80dc\u56f44\u53f7\u7ebf\u7adf\u7136\u505c\u4e86\uff0c\u53ea\u597d\u53bb\u6253\u8f66\uff0c\u65e0\u5948\u624b\u673a\u6ca1\u7535\uff0c\u53eb\u8f66\u4e5f\u53eb\u4e0d\u4e86\uff0c\u9ed1\u8f66\uff0c\u7684\u58eb\u90fd\u5750\u5730\u8d77\u4ef7\uff0c\u8fd8\u597d\u6709\u597d\u5fc3\u4eba\u901a\u8fc7\u53eb\u8f66\u8f6f\u4ef6\u4e00\u8d77\u4f1a\u53bb\uff0c\u7136\u540e\u534a\u8def\u5230\u597d\u6253\u8f66\u7684\u5730\u65b9\u6211\u4eec\u518d\u6253\u8f66\u56de\u53bb\uff01\uff01\uff01\u771f\u662f\u4e00\u6ce2N\u6298\u554a\uff01\uff01\uff01\u7ecf\u9a8c4:\u56de\u7a0b\u5c3d\u91cf\u65e9\u70b9\u6216\u8005\u5b9a\u665a\u70b9\u7684\u8f7b\u8f68\u73ed\u6b21\u7684\u7968\u3002</p>","tags":["photography","tourism","marcau"]},{"location":"blog/2016/07/15/openwrt-%E4%B8%8A%E6%90%AD%E5%BB%BA-shadowvpn-server/","title":"openwrt \u4e0a\u642d\u5efa ShadowVPN Server","text":"<p>\u8be5\u6587\u4e3b\u8981\u662f\u9488\u5bf9 ShadowVPN \u5728 openwrt \u4e0a\u9762\u914d\u7f6e\u6210 Server \u7aef\u7684\u4ecb\u7ecd\u3002</p>","tags":["ShadowVPN","VPN","openwrt","shadowsock"]},{"location":"blog/2016/07/15/openwrt-%E4%B8%8A%E6%90%AD%E5%BB%BA-shadowvpn-server/#shadowvpn","title":"\u5173\u4e8eShadowVPN","text":"<p>\u5173\u4e8e ShadownVPN \u7684\u4ecb\u7ecd\u9664\u4e86\u770b\u5176\u5b98\u65b9\u7684 wiki \u6587\u6863\u5916\uff0c\u6211\u4e2a\u4eba\u6709\u51e0\u70b9\u7406\u89e3:  - \u4f7f\u7528\u7684\u662f udp \u534f\u8bae\uff0c\u6709\u5229\u4e8e\u901f\u5ea6\u7684\u540c\u65f6\u4e5f\u7ed9 GFW \u6293\u53d6\u5176\u7279\u5f81\u589e\u52a0\u96be\u5ea6  - \u4f7f\u7528\u4e86 libsodium \u8fdb\u884c\u5bf9\u79f0\u7684\u70b9\u5bf9\u70b9\u52a0/\u89e3\u5bc6\uff0cCPU\u6d88\u8017\u4e0a\u6bd4\u8f83\u4e50\u89c2  - \u57fa\u4e8e tun \u7684\u8def\u7531\u914d\u7f6e\u8f83\u7b80\u5355\uff0c\u4fbf\u4e8e\u7ba1\u7406</p>","tags":["ShadowVPN","VPN","openwrt","shadowsock"]},{"location":"blog/2016/07/15/openwrt-%E4%B8%8A%E6%90%AD%E5%BB%BA-shadowvpn-server/#_1","title":"\u5f00\u59cb\u5b89\u88c5","text":"<p>\u83b7\u53d6\u5bf9\u5e94\u7684 ipk \u5b89\u88c5\u5305\uff0c\u6240\u6709\u5b89\u88c5\u5305\u89c1\uff1aSourceforge openwrt-shadowvpn \u4ee5\u6211\u7684 HG556A \u4e3a\u4f8b\u5b89\u88c5\u7684\u662fShadowVPN_0.2.0-1_brcm63xx.ipk</p> <pre><code>root@OpenWrt:/tmp# wget https://sourceforge.net/projects/openwrt-dist/files/shadowvpn/0.2.0-e335cac/ShadowVPN_0.2.0-1_brcm63xx.ipk/download\nroot@OpenWrt:/tmp# opkg install ShadowVPN_0.2.0-1_brcm63xx.ipk\nroot@OpenWrt:/tmp# opkg files ShadowVPN\nPackage ShadowVPN (0.2.0-1) is installed on root and has the following files:\n/etc/init.d/shadowvpn\n/etc/hotplug.d/iface/30-shadowvpn\n/etc/shadowvpn/client_down.sh\n/usr/bin/shadowvpn\n/etc/shadowvpn/client_up.sh\n/etc/config/shadowvpn\n</code></pre>","tags":["ShadowVPN","VPN","openwrt","shadowsock"]},{"location":"blog/2016/07/15/openwrt-%E4%B8%8A%E6%90%AD%E5%BB%BA-shadowvpn-server/#_2","title":"\u914d\u7f6e","text":"<p>\u7531\u4e8e\u5b89\u88c5\u5305\u9ed8\u8ba4\u662f\u63d0\u4f9b\u7ed9 client \u4f7f\u7528\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u589e\u52a0 server \u7528\u7684\u914d\u7f6e\u8ddf\u53bb\u6389\u4e00\u4e0b\u4e0d\u9700\u8981\u7684\u6587\u4ef6</p> <ul> <li>\u589e\u52a0\u914d\u7f6e server.conf , \u6ce8\u610f\u6587\u4ef6\u683c\u5f0f\u662f \u5b57\u6bb5=\u503c\uff0c = \u53f7\u4e24\u8fb9\u90fd\u4e0d\u80fd\u6709\u7b49\u53f7\u3002\u56e0\u4e3a\u8fd9\u4e2a\u662f\u4e00\u4e2ashell\u7684\u914d\u7f6e\u3002</li> </ul> <pre><code>root@OpenWrt:/tmp# cat /etc/shadowvpn/server.conf | grep -v ^# | grep -v ^$\nserver=0.0.0.0\nport=1123\npassword=68b35f94c6436421ed697011029b43c7\nmode=server\nconcurrency=1\nmtu=1432\nintf=tun0\nnet=10.8.0.1/16\nup=/etc/shadowvpn/server_up.sh\ndown=/etc/shadowvpn/server_down.sh\npidfile=/var/run/shadowvpn.pid\nlogfile=/var/log/shadowvpn.log\n</code></pre> <ul> <li>\u589e\u52a0 server_up.sh\uff0c \u8fd9\u4e2a\u662f server \u542f\u52a8\u7684\u65f6\u5019\u6267\u884c\u7684\u547d\u4ee4\u811a\u672c.</li> </ul> <pre><code>root@OpenWrt:/tmp# cat /etc/shadowvpn/server_up.sh | grep -v ^# | grep -v ^$\nsysctl -w net.ipv4.ip_forward=1\nip addr add $net dev $intf\nip link set $intf mtu $mtu\nip link set $intf up\nif !(iptables-save -t nat | grep -q \"shadowvpn\"); then\n  iptables -t nat -I POSTROUTING -s $net ! -d $net -m comment --comment \"shadowvpn\" -j MASQUERADE\nfi\niptables -I FORWARD -s $net -j ACCEPT\niptables -I FORWARD -d $net -j ACCEPT\niptables -t mangle -A FORWARD -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu\necho $0 done\n# \u6ce8\u610f\u4e0a\u9762\u7684 FORWARD \u89c4\u5219\uff0c\u5982\u679c\u4e0d\u52a0\uff0c\u90a3\u4e48 client \u5c31\u8d70\u4e0d\u51fa\u53bb\uff0c\u5373\u4e0a\u4e0d\u4e86\u516c\u7f51\uff0c\u53ea\u80fd\u8ddf 10.8.0.0/16 \u7f51\u7edc\u76f8\u901a\u3002\n</code></pre> <ul> <li>\u589e\u52a0 server_down.sh\uff0c \u8fd9\u4e2a\u662f server \u5173\u95ed\u7684\u65f6\u5019\u6267\u884c\u7684\u547d\u4ee4\u811a\u672c.</li> </ul> <pre><code>root@OpenWrt:/tmp# cat /etc/shadowvpn/server_down.sh | grep -v ^# | grep -v ^$\niptables -t nat -D POSTROUTING -s $net ! -d $net -m comment --comment \"shadowvpn\" -j MASQUERADE\niptables -D FORWARD -s $net -j ACCEPT\niptables -D FORWARD -d $net -j ACCEPT\niptables -t mangle -D FORWARD -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu\necho $0 done\n</code></pre> <ul> <li>\u5220\u6389\u4e0d\u9700\u8981\u7684\u6587\u4ef6  \u56e0\u4e3a\u521a\u624d\u8bf4\u4e86\u8fd9\u4e2a ipk \u5305\u4e3b\u8981\u662f\u9488\u5bf9 client \u7684\u3002\u6211\u4eec\u9700\u8981\u7684\u4ec5\u4ec5\u662f /usr/bin/shadowvpn \u8fd9\u4e2a\u53ef\u6267\u884c\u7684\u6587\u4ef6\u3002</li> </ul> <pre><code>root@OpenWrt:/tmp# /etc/init.d/shadowvpn disable\nroot@OpenWrt:/tmp# mv /etc/init.d/shadowvpn /root/shadowvpn.bk\nroot@OpenWrt:/tmp# mv /etc/hotplug.d/iface/30-shadowvpn/root/30-shadowvpn.bk\n</code></pre> <ul> <li>\u5f00\u653e wan \u53e3\u7684shadowvpn\u7684\u670d\u52a1\u7aef\u53e31123 \u5177\u4f53\u591a\u5c11\u770b  server.conf \u914d\u7f6e</li> </ul> <pre><code>root@OpenWrt:~# cat &gt;&gt; /etc/config/firewall &lt;&lt;_EOF\nconfig rule\n        option name 'Allow-ShadowVPN'\n        option src 'wan'\n        option proto 'udp'\n        option dest_port '1123'\n        option target 'ACCEPT'\n        option family 'ipv4'\n _EOF\n root@OpenWrt:~# /etc/init.d/firewall reload\n</code></pre>","tags":["ShadowVPN","VPN","openwrt","shadowsock"]},{"location":"blog/2016/07/15/openwrt-%E4%B8%8A%E6%90%AD%E5%BB%BA-shadowvpn-server/#_3","title":"\u542f\u52a8\u670d\u52a1\u7aef","text":"<pre><code>root@OpenWrt:~# /usr/bin/shadowvpn -c /etc/shadowvpn/server.conf -s start\n</code></pre> <p>\u542f\u52a8\u6210\u529f\u540e ip a \u53ef\u4ee5\u770b\u5230\u4e00\u4e2a tun0 \u7684\u7f51\u53e3</p> <pre><code>root@OpenWrt:~# ip addr show dev tun0\n14: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1432 qdisc fq_codel state UNKNOWN group default qlen 500\n    link/none \n    inet 10.8.0.1/16 scope global tun0\n       valid_lft forever preferred_lft forever\n</code></pre>","tags":["ShadowVPN","VPN","openwrt","shadowsock"]},{"location":"blog/2016/07/15/openwrt-%E4%B8%8A%E6%90%AD%E5%BB%BA-shadowvpn-server/#_4","title":"\u5ba2\u6237\u7aef","text":"<p>\u6211\u5ba2\u6237\u7aef\u662f\u516c\u53f8\u7684\u7535\u8111\uff0c\u7cfb\u7edf\u662f Linux\uff0c \u6240\u4ee5\u76f4\u63a5\u4ece github clone \u4e0b\u6765\u7f16\u8bd1\u5373\u53ef\u3002\u7531\u4e8e\u79cd\u79cd\u539f\u56e0\u4f5c\u8005\u5df2\u7ecf\u4ece github \u4e0a\u9762\u628a\u4ee3\u7801\u5220\u6389\u4e86\uff0c\u4f46\u662f\u6709\u5f88\u591a\u4eba\u90fdfork\u4e86\uff0c\u6240\u4ee5\u53ef\u4ee5\u4e0b\u8f7d\u5176\u4e2d\u4e00\u4e2a \u6bd4\u5982\uff1a Github \u7f16\u8bd1\u5c31\u4e0d\u591a\u8bf4\uff0c\u5b89\u88c5\u5b98\u65b9\u8bf4\u660e\u64cd\u4f5c\u5c31\u884c\u3002\u6ce8\u610f\u4e00\u4e0b libsodium \u8fd9\u4e2a\u9700\u8981\u4eceGithub\u83b7\u53d6\u3002</p>","tags":["ShadowVPN","VPN","openwrt","shadowsock"]},{"location":"blog/2016/07/15/openwrt-%E4%B8%8A%E6%90%AD%E5%BB%BA-shadowvpn-server/#_5","title":"\u914d\u7f6e\u5ba2\u6237\u7aef","text":"<p><pre><code>yorks /etc/shadowvpn $ cat client.conf  | grep -v ^# | grep -v ^$\nserver=120.85.223.199\n##\u4e0a\u9762\u7684ip \u662f ${\u60a8 openwrt wan\u53e3 \u5916\u7f51ip\u5730\u5740}\nport=1123\npassword=68b35f94c6436421ed697011029b43c7\nmode=client\nconcurrency=1\nmtu=1432\nintf=tun0\nnet=10.8.0.2/24\nup=/etc/shadowvpn/client_up.sh\ndown=/etc/shadowvpn/client_down.sh\npidfile=/var/run/shadowvpn.pid\nlogfile=/var/log/shadowvpn.log\n</code></pre> -  \u4fee\u6539 client_up.sh client_down.sh \u7684\u811a\u672c</p> <pre><code># client_up.sh \u6ce8\u91ca\u4e0b\u9762\u4e24\u884c \u56e0\u4e3a\u6211\u7528\u7684\u662f\u5c40\u90e8\u8def\u7531\uff0c\u4e0d\u662f\u5168\u5c40\u8def\u7531\n# Shadow default route using two /1 subnets\n##ip route add   0/1 dev $intf\n##ip route add 128/1 dev $intf\n\n# client_down.sh \u6ce8\u91ca\u4e0b\u9762\u4e24\u884c\n##ip route del   0/1\n##ip route del 128/1\n</code></pre>","tags":["ShadowVPN","VPN","openwrt","shadowsock"]},{"location":"blog/2016/07/15/openwrt-%E4%B8%8A%E6%90%AD%E5%BB%BA-shadowvpn-server/#_6","title":"\u542f\u52a8\u5ba2\u6237\u7aef","text":"<pre><code>[root@c720 ShadowVPN]#  ./bin/shadowvpn -c etc/shadowvpn/client.conf -s start\nSat May 21 18:42:23 2016 warning: concurrency is temporarily disabled on this version, make sure to set concurrency=1 on the other side\nstarted\n[root@c720 ShadowVPN]# ip addr show dev tun0\n5: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1432 qdisc noqueue state UNKNOWN group default qlen 500\n    link/none \n    inet 10.8.0.2/24 scope global tun0\n       valid_lft forever preferred_lft forever\n</code></pre>","tags":["ShadowVPN","VPN","openwrt","shadowsock"]},{"location":"blog/2016/07/15/openwrt-%E4%B8%8A%E6%90%AD%E5%BB%BA-shadowvpn-server/#_7","title":"\u6d4b\u8bd5","text":"<pre><code>[root@c720 ShadowVPN]# ping 10.8.0.1\nPING 10.8.0.1 (10.8.0.1) 56(84) bytes of data.\n64 bytes from 10.8.0.1: icmp_seq=1 ttl=64 time=5.28 ms\n64 bytes from 10.8.0.1: icmp_seq=2 ttl=64 time=4.85 ms\n64 bytes from 10.8.0.1: icmp_seq=3 ttl=64 time=4.81 ms\n# ping \u901a openwrt \u7684\u670d\u52a1\u7aefip\u4e86 \u8bf4\u660e\u670d\u52a1\u662f\u6b63\u5e38\u7684\u3002\n</code></pre>","tags":["ShadowVPN","VPN","openwrt","shadowsock"]},{"location":"blog/2016/07/15/openwrt-%E4%B8%8A%E6%90%AD%E5%BB%BA-shadowvpn-server/#_8","title":"\u8def\u7531\u7ba1\u7406","text":"<p>\u4e3e\u4f8b\u8bf4\u660e\uff0c\u6bd4\u5982\u6211\u8981\u8fde\u56de\u5bb6\u4e0a ip.cn \u8fd9\u4e2a\u7f51\u7ad9\uff0c\u90a3\u4e48\u8fd9\u6837\u64cd\u4f5c:</p> <pre><code>[root@c720 ShadowVPN]# dig ip.cn +short\n42.159.28.168\n[root@c720 ShadowVPN]# ip r add 42.159.28.168 dev tun0\n[root@c720 ShadowVPN]# curl http://ip.cn\n\u5f53\u524d IP\uff1a120.85.223.199 \u6765\u81ea\uff1a\u5e7f\u4e1c\u7701\u5e7f\u5dde\u5e02 \u8054\u901a\n\n\u51fa\u73b0\u7684 ip \u5730\u5740\u662f server \u7684\u5916\u7f51. \u8fd9\u5c31\u8bf4\u660e\u662f\u8d70\u4e86 vpn \u901a\u9053\u4e86\u3002\n\u5176\u4ed6\u7684\u8def\u7531\u4e5f\u4e00\u6837\uff0c\u6bd4\u5982 qq \u7684\uff0c\u60f3\u518d\u516c\u53f8\u4e0a qq \u5148\u67e5 qq \u7684 ip \u5730\u5740\u8303\u56f4\uff0c\u7136\u540e\u90fd\u52a0\u5230 tun0 \u53e3\u51fa\u53bb\u5373\u53ef\u3002\n</code></pre>","tags":["ShadowVPN","VPN","openwrt","shadowsock"]},{"location":"blog/2025/12/30/install-archlinux-on-cloud-virtual-machine-with-disk-encryption/","title":"\u5728\u4e91\u4e3b\u673a\u4e0a\u52a0\u5bc6\u78c1\u76d8\u6765\u5b89\u88c5archlinux","text":"<p>\u5f53\u524d\u4e91\u4e3b\u673a\u63d0\u4f9b\u4e86\u516c\u7f51\uff0c\u5bb6\u91cc\u6ca1\u6709\u516c\u7f51IP\uff0c\u53ea\u80fd\u4f9d\u8d56\u4e91\u4e3b\u673a\u6765\u505a\u4e2d\u8f6c\uff0c \u867d\u7136\u5f53\u524dreinstall\u811a\u672c\u975e\u5e38\u4f18\u79c0\uff0c\u4f46\u662f\u6709\u4e9b\u4e1c\u897f\u6211\u60f3\u81ea\u5b9a\u4e49\uff0c \u6bd4\u5982\u52a0\u5bc6\u67d0\u4e2a\u5206\u533a\uff0c\u5c31\u8981\u81ea\u5df1\u52a8\u624b\u4e86\u3002</p>","tags":["luks","encrypt","vm","security","archlinux","cloud","disk","grub","initrd","dropbear","ssh","mkinitcpio"]},{"location":"blog/2025/12/30/install-archlinux-on-cloud-virtual-machine-with-disk-encryption/#archlinuxgrubiso","title":"\u5148\u91cd\u88c5archlinux\u6765\u652f\u6301grub\u5f15\u5bfcISO\u542f\u52a8","text":"<p>\u76f4\u63a5\u4f7f\u7528 reinstall \u56fd\u5185\u811a\u672c</p> <p>\u6267\u884c\u5b8c\u811a\u672c\u540e\u76f4\u63a5reboot\u5c31\u81ea\u52a8\u5b89\u88c5\u597darchlinnux\u4e86\uff0c\u5f88\u65b9\u4fbf\u3002 \u5982\u679c\u6ca1\u6709\u52a0\u5bc6\u9700\u6c42\uff0c\u8fd9\u662f\u4e00\u4e2a\u5f88\u5e72\u51c0\u7684\u7cfb\u7edf\uff0c\u6ca1\u6709\u4e91\u670d\u52a1\u5668\u63d0\u4f9b\u7684 \u5404\u79cdagent\u540e\u95e8\u3002</p> <p>\u5982\u679c\u6709\u52a0\u5bc6\u9700\u6c42\u7ee7\u7eed\u5f80\u4e0b\u3002</p> <ul> <li>\u4e0b\u8f7d archlinux.iso <pre><code>curl -L -o /archlinux.iso https://mirrors.nju.edu.cn/archlinux/iso/latest/archlinux-x86_64.iso\n</code></pre></li> <li> <p>\u6dfb\u52a0grub\u5f15\u5bfciso\u7684\u914d\u7f6e <pre><code>sd=$(findmnt / -n | awk '{print $2}')\n[[ -z $uuid  ]] &amp;&amp; { echo \"input / /dev/sd? \" &amp;&amp; read sd \nuuid=$(blkid $sd | grep -Eo '\\s+UUID=\"[^\"]+' | awk -F'\"' '{print $2}')\n\ncat &gt;&gt;/etc/grub.d/40_custom&lt;&lt;_EOF\nmenuentry \"Arch Linux ISO from HDD\" {\n    search --no-floppy --fs-uuid --set=root $uuid\n    set iso_file=\"/archlinux.iso\"\n    loopback loop \\$iso_file\n    linux (loop)/arch/boot/x86_64/vmlinuz-linux img_dev=$sd img_loop=\\$iso_file earlymodules=loop archisobase\ndir=arch copytoram=y\n    initrd (loop)/arch/boot/x86_64/initramfs-linux.img\n}\n_EOF\ngrub-mkconfig -o /boot/grub/grub.cfg\n</code></pre> \u6ce8\u610f : copytoram=y \u5982\u679c\u5185\u5b58\u4e0d\u591f\u5c31\u8981\u5148\u5206\u4e00\u4e2a\u5c0f\u5206\u533a\u7528\u6765\u653e iso \u6587\u4ef6</p> </li> <li> <p>\u8bbe\u7f6e\u5f15\u5bfciso\u542f\u52a8\u4e3a\u9ed8\u8ba4\u542f\u52a8\u65b9\u5f0f <pre><code>index=$(grep -Ec  'menuentry\\s+' /boot/grub/grub.cfg | awk '{print $1-1}')\ngrep -q GRUB_DEFAULT=$index /etc/default/grub || sed -i \"s/^GRUB_DEFAULT=.*/GRUB_DEFAULT=$index/g\" /etc/defau\nlt/grub\n\ngrub-mkconfig -o /boot/grub/grub.cfg\n</code></pre></p> </li> <li> <p>\u91cd\u542f\u8fdb\u53bbISO \u6309\u7167\u7cfb\u7edf\u754c\u9762</p> </li> </ul>","tags":["luks","encrypt","vm","security","archlinux","cloud","disk","grub","initrd","dropbear","ssh","mkinitcpio"]},{"location":"blog/2025/12/30/install-archlinux-on-cloud-virtual-machine-with-disk-encryption/#_1","title":"\u624b\u5de5\u5b89\u88c5\u7cfb\u7edf","text":"<p>\u8fd9\u6b65\u53ef\u4ee5ssh\u8fdb\u53bb\uff0c\u56e0\u4e3aarchlinux.iso\u9ed8\u8ba4\u5f00\u4e8622\u7684sshd\u94fe\u63a5 \u907f\u514d\u8fd9\u4e2a\u65f6\u5019\u4eba\u8fde\u8fdb\u6765\uff0c\u53ef\u4ee5\u5229\u7528 iptables \u52a0\u4e00\u4e0b\u9632\u706b\u5899 <pre><code>iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\niptables -A INPUT -s $YOUR-IP -j ACCEPT\niptables -A INPUT -j DROP\n</code></pre> - \u5206\u533a \u7c7b\u4f3c\u8fd9\u6837 <pre><code> vda       254:0    0   40G  0 disk  \n\u251c\u2500vda1    254:1    0  100M  0 part  /boot\n\u2514\u2500vda2    254:2    0 39.9G  0 part  \n</code></pre> \u4e3a\u4ec0\u4e48\u8981\u4fdd\u7559 /boot \u4e0d\u52a0\u5bc6\u5462\uff1f\u4e5f\u53ef\u4ee5\u5168\u76d8\u52a0\u5bc6\uff0c\u4f46\u662f\u6bcf\u6b21\u91cd\u542f\u90fd\u9700\u8981\u901a\u8fc7 \u4e91\u670d\u52a1\u5546\u7684 vnc \u6216\u8005 console \u4e4b\u7c7b\u8fdb\u53bb\u8f93\u5165\u89e3\u5bc6\u78c1\u76d8\u7684\u5bc6\u7801\u8fdb\u884c\u89e3\u5bc6\u540e\u624d\u80fd\u8fdb\u53bb\u7cfb\u7edf\u3002 \u5982\u679c\u670d\u52a1\u5546\u5728vnc\u6216\u8005console\u91cc\u9762\u505a\u624b\u811a\u8fd9\u6837\u5f88\u5bb9\u6613\u83b7\u53d6\u5230\u52a0\u5bc6\u5bc6\u7801\u3002</p> <p>\u8fd9\u91cc\u8ba9/boot\u4e0d\u52a0\u5bc6\uff0c\u653e\u4e00\u4e9b\u7528\u6765\u542f\u52a8\u7684\u7cfb\u7edf\u7684\u6587\u4ef6\uff0c\u6bd4\u5982efi, initrd.img vmlinuz\u3002 \u770b\u5230\u8fd9\u91cc\uff0c\u4f60\u4e5f\u8bb8\u4f1a\u6709\u7591\u95ee\uff0c\u90a3\u670d\u52a1\u5546\u4e5f\u53ef\u80fd\u5728\u8fd9\u4e9b\u6587\u4ef6\u4e0a\u505a\u624b\u811a\uff0c\u7b49\u4f60\u542f\u52a8\u7684\u65f6\u5019 \u83b7\u53d6\u4f60\u8fdc\u7a0b\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e5f\u4e00\u6837\u53ef\u4ee5\u7834\u89e3\u4e86\u5417\uff1f\u662f\u7684\uff0c\u6309\u7406\u662f\uff0c\u540e\u9762\u6211\u518d\u8bf4\u8fd9\u4e2a\u9632\u62a4\u624b\u6bb5\u3002</p> <p>\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 lvmEncrypting_an_entire_system#LUKS_on_LVM, \u6211\u8fd9\u91cc\u6ca1\u6709\u6269\u5bb9 \u78c1\u76d8\u7684\u9700\u6c42\u5c31\u5148\u4e0d\u7528lvm\u4e86\u3002</p> <ul> <li> <p>\u52a0\u5bc6 vda2 <pre><code>cryptsetup luksFormat --type luks1 --use-random -S 1 -s 512 -h sha512 -i 5000 /dev/vda2\ncryptsetup open /dev/vda2 crypt\n# \u770b\u5230\u5206\u533a\u7ed3\u6784\nlsblk\n vda       254:0    0   40G  0 disk  \n\u251c\u2500vda1    254:1    0  100M  0 part  /boot\n\u2514\u2500vda2    254:2    0 39.9G  0 part  \n  \u2514\u2500crypt 253:0    0 39.9G  0 crypt /\n</code></pre></p> </li> <li> <p>mount newOS\u76ee\u5f55 <pre><code>mkfs.ext4 /dev/mapper/crypt\nmount /dev/mapper/crypt /mnt\nmount --mkdir /dev/vda1 /mnt/boot\n</code></pre></p> </li> <li> <p>\u540e\u9762\u5c31\u8ddf\u6b63\u5e38\u5b89\u88c5archlinux\u4e00\u6837\u4e86 Install_Guide \u6bd4\u5982 <pre><code>timedatectl set-ntp true\necho 'Server = https://mirrors.nju.edu.cn/archlinux/$repo/os/$arch' &gt; /etc/pacman.d/mirrorlist\npacstrap -K /mnt base vim grub openssh efibootmgr dosfstools sudo\ngenfstab -U /mnt &gt;&gt; /mnt/etc/fstab\narch-chroot /mnt\necho myarch &gt; /etc/hostname\nln -sf /usr/share/zoneinfo/Asia/Hong_Kong /etc/localtime\ncat&gt;/etc/systemd/timesyncd.conf&lt;&lt;_EOF\n[Time]\nNTP=ntp.aliyun.com\nFallbackNTP=0.arch.pool.ntp.org 1.arch.pool.ntp.org 2.arch.pool.ntp.org 3.arch.pool.ntp.org\n_EOF\n\ncat&gt;/etc/systemd/network/10-wire.network&lt;&lt;_EOF\n[Match]\nName=enp*\nName=ens*\n\n[Network]\nDHCP=ipv4\nDNS=223.5.5.5\n_EOF\n\necho 'nameserver 223.5.5.5' &gt; /etc/resolv.conf\nsed -i 's/^#en_US.UTF-8/en_US.UTF-8/g'  /etc/locale.gen\nlocale-gen\necho 'LANG=en_US.UTF-8' &gt; /etc/locale.conf\n\necho 'myarch' &gt; /etc/hostname\n\nuseradd yorks\nusermod -G whell -a yorks\npasswd yorks\n\nmkdir -p /home/yorks/.ssh \ncp -f /etc/skel/.bash* /home/yorks/\necho 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICnGCMPoPA/CwHePhSwqwNH4dt3bARrb4sDIymMpbT2b yangyou' &gt; /home/yorks\n/.ssh/authorized_keys\nchmod 0600 /home/yorks/.ssh/authorized_keys\nchown -R yorks:yorks /home/yorks\nchmod 0700 /home/yorks\n\ncat&gt;/etc/ssh/sshd_config.d/10-keyonly.conf&lt;&lt;_EOF\nPort 22\nProtocol 2\nPermitRootLogin no\nPubkeyAuthentication yes\nAuthorizedKeysFile .ssh/authorized_keys\nPasswordAuthentication no\nChallengeResponseAuthentication no\nPermitEmptyPasswords no\nUseDNS no\nAllowUsers yorks\nLogLevel Debug\n_EOF\n\n# \u5982\u679c\u6709\u5176\u4ed6\u8f6f\u4ef6\u9700\u6c42\u4e00\u8d77\u5b89\u88c5\u4e86\n# \u6bd4\u5982\u6211\u6709nginx stream \u6a21\u5757\u5229\u7528tls\u6765\u767b\u5f55 sshd \u7b49..\npacman -S nginx nginx-mod-stream wireguard-tools cronie\nsed 's/^MAILTO=.*/MAILTO=\"\"/g' /etc/cron.d/0hourly\n</code></pre></p> </li> <li> <p>\u5b89\u88c5\u652f\u6301\u52a0\u5bc6\u7684initrd\u5de5\u5177 <pre><code>pacman -S linux mkinitcpio-netconf mkinitcpio-dropbear mkinitcpio-utils\n</code></pre></p> </li> <li><code>mkinitcpio-netconf</code> \u662f\u4e3a\u4e86grub\u542f\u52a8\u7684\u65f6\u5019\u652f\u6301\u914d\u7f6e\u7f51\u7edc</li> <li><code>mkinitcpio-dropbear</code> \u662f\u4e3a\u4e86grub\u542f\u52a8\u7684\u65f6\u5019\u652f\u6301\u914d\u7f6e\u7f51\u7edc</li> <li> <p><code>mkinitcpio-utils</code> \u914d\u7f6einitrd\u7684\u5de5\u5177\u5305,\u5305\u62ec<code>encrytssh</code></p> </li> <li> <p>\u628avda1\u7684\u6587\u4ef6\u7cfb\u7edfko\u6253\u8fdb\u53bbinitrd.img <pre><code># /mkinitcpio.conf\ngrep 'MODULES=(vfat fat)'\n</code></pre></p> </li> <li> <p>\u628aencrypt\u76f8\u5173\u5de5\u5177\u6253\u5230initrd.img <pre><code># /etc/mkinitcpio.conf\nHOOKS=(base udev autodetect microcode modconf kms keyboard keymap consolefont block netconf dropbear encryptssh filesystems fsck)'\n</code></pre></p> </li> <li> <p>\u4fee\u6539encryptssh \u8ba9\u652f\u6301ssh\u767b\u5f55 <pre><code># /usr/lib/initcpio/install/encryptssh\nmake_etc_passwd() {\n    #echo 'root:x:0:0:root:/root:/bin/cryptsetup_shell' &gt; \"${BUILDROOT}\"/etc/passwd\n    #echo '/bin/cryptsetup_shell' &gt; \"${BUILDROOT}\"/etc/shells\n    echo 'root:x:0:0:root:/root:/bin/sh' &gt; \"${BUILDROOT}\"/etc/passwd\n    echo '/bin/sh' &gt; \"${BUILDROOT}\"/etc/shells\n}\n</code></pre></p> </li> <li> <p>\u4fee\u590d dropbear\u7684 dss\u95ee\u9898 <pre><code># /usr/lib/initcpio/install/dropbear\n  for keytype in rsa ecdsa ; do\n#                   ^ remove dss\n</code></pre></p> </li> <li> <p>\u4fee\u6539grub \u76f8\u5173\u5185\u6838\u53c2\u6570cmdline <pre><code>blkid /dev/vda2\n# /etc/default/grub\nGRUB_CMDLINE_LINUX=\"ip=dhcp cryptdevice=UUID=&lt;uuid of vda2&gt;:crypt\"\n</code></pre></p> </li> <li> <p>\u91cd\u65b0\u751f\u6210initrd.img \u8ddf grub.cfg <pre><code>mkinitcpio -P\ngrub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB --recheck\ngrub-mkconfig -o /boot/grub/grub.cfg\n</code></pre></p> </li> <li>\u786e\u8ba4sshd networkd\u7b49\u81ea\u542f  <pre><code>systemctl enable systemd-timesyncd\nsystemctl enable systemd-networkd\nsystemctl enable sshd\n\n# \u7981\u6b62\u7528\u6237\u7528\u5bc6\u7801\u767b\u5f55 \u4e5f\u5c31\u662f\u7981\u6b62\u7528\u6237\u4ececonsole ttyS0\u7b49\u7ec8\u7aef\u767b\u5f55\n# \u53ea\u6709ssh\u624d\u80fd\u767b\u5f55  # \u6ce8\u610f\u91cd\u8981\u6570\u636e\u8bf7\u5b9a\u671f\u5907\u4efd\u8d70\npasswd -l yorks\npasswd -l root\n# should we disable all user from tty ??\n## cat /etc/securetty\n\ncd /boot &amp;&amp; sha256sum vmlinuz-linux initramfs-linux.img\nexit \n\n# \u8bb0\u5f55\u4e0a\u9762\u4e24\u4e2asha256sum\n</code></pre> \u6ce8\u610f: \u6bcf\u6b21\u6709\u66f4\u65b0\u5230initrd.img \u90fd\u9700\u6267\u884c\u8fd9\u4e2a\u547d\u4ee4\u6216\u8005\u53ef\u4ee5\u5199\u5728pacman\u7684hook\u91cc\u9762  \u7136\u540e\u590d\u5236\u51fa\u6765\u4fdd\u5b58\u597d.</li> </ul>","tags":["luks","encrypt","vm","security","archlinux","cloud","disk","grub","initrd","dropbear","ssh","mkinitcpio"]},{"location":"blog/2025/12/30/install-archlinux-on-cloud-virtual-machine-with-disk-encryption/#_2","title":"\u91cd\u542f\u767b\u5f55\u89e3\u5bc6","text":"<p><pre><code>#!/bin/bash\n\necho -n \"\ud83d\udd0d \u6b63\u5728\u6302\u8f7d boot \u5206\u533a\u5e76\u6821\u9a8c...\"\n\nREMOTE_CMD=\"mkdir -p /tmp/boot_check &amp;&amp; \\\n            mount -t vfat /dev/vda1 /tmp/boot_check &amp;&amp; \\\n            cd /tmp/boot_check/ &amp;&amp; \\\n            sha256sum vmlinuz-linux initramfs-linux.img &amp;&amp; \\\n            umount /tmp/boot_check\"\n\nHOST=\"root@${YOUR-VM-IP\"\nPORT=\"22\"\nwhile sleep 1; do\n    ssh -p $PORT $HOST pwd | grep -q ^/root &amp;&amp; break\ndone\nssh -p $PORT $HOST \"$REMOTE_CMD\" 2&gt;/dev/null &gt; /tmp/hash.remote\nvmhash=\"hash-of-vmlinuz\" # 129a122f14f2398528e6585cae8301e479501cc8c41fb377356496c7edb85db6\ninhash=\"hash-of-initramfs-linux.img\" # 6dcf13fd3609f065ef1a85292a29e8fe95c4c13499a5468a7a350d24654e5a40\n\ngrep vmlinuz /tmp/hash.remote | grep -q $vmhash || {\n    echo \"\ud83d\udea8 \u4e25\u91cd\u8b66\u544a\uff1a\u8fdc\u7a0bvmlinux\u54c8\u5e0c\u4e0d\u5339\u914d\uff01\u505c\u6b62\u64cd\u4f5c!\u672c\u5730: $vmhash \"\n    cat /tmp/hash.remote\n    exit 1\n}\n\ngrep initramfs /tmp/hash.remote | grep -q $inhash || {\n    echo \"\ud83d\udea8 \u4e25\u91cd\u8b66\u544a\uff1a\u8fdc\u7a0binitramfs\u54c8\u5e0c\u4e0d\u5339\u914d\uff01\u505c\u6b62\u64cd\u4f5c\uff01\u672c\u5730: $inhash\"\n    cat /tmp/hash.remote\n    exit 2\n}\n\necho \"\u2705 \u6821\u9a8c\u901a\u8fc7\u3002\"\n\necho \"\ud83d\udd13 \u6b63\u5728\u53d1\u9001\u89e3\u9501\u6307\u4ee4...\"\nssh -p $PORT $HOST \"/bin/cryptsetup_shell\" &amp;&amp;  echo \"\ud83d\ude80 \u89e3\u9501\u6307\u4ee4\u53d1\u9001\u6210\u529f\uff01\u670d\u52a1\u5668\u6b63\u5728\u542f\u52a8...\"\n</code></pre> \u53ef\u4ee5\u770b\u5230\u8fd9\u6b65\u9aa4\u89e3\u51b3\u4e86\u4e4b\u524d\u7684\u7591\u95ee.</p>","tags":["luks","encrypt","vm","security","archlinux","cloud","disk","grub","initrd","dropbear","ssh","mkinitcpio"]}]}